class PopselTexture{constructor(e){if(this.shape=e,"points"==this.shape.nature?this.pupselNumber=getRandomFromList([500,400,300,200]):this.pupselNumber=500,this.brushNumber=15,this.brushSize=e.brushSize,this.brushStrokeWeight=1,this.spriteCount=10,this.pupselSize=DOMINANTSIDE/this.pupselNumber,this.pupselColors=PALETTE.pixelColors,this.pattern=getRandomFromList([0,0,3,4,5]),this.pupsels=[],this.sprites={},this.buffer=createGraphics(.3*DOMINANTSIDE,.3*DOMINANTSIDE),"pupsel"==this.shape.nature||"plain"==this.shape.nature?this.drawShape():"naked"==this.shape.nature&&this.drawNakedShape(),"pupsel"==this.shape.nature||"points"==this.shape.nature)for(var h,s=0,t=0;t<=this.buffer.height;t+=this.pupselSize)for(var i=0;i<=this.buffer.width;i+=this.pupselSize)s+=1,insidePolygon([i,t],this.shape.coords)&&(h=this.shape.color,this.pattern>0&&s%this.pattern==0&&(h=this.shape.colorB),h=brightenSuperNew(h,map(i,this.shape.B.x,this.shape.C.x,-25,25)),"points"==this.shape.nature?this.showPoints(i,t,h):this.createBrushTiles(i,t,h))}drawShape(){this.strokeWeight=1,this.blurSize=2,this.bufferShape=createGraphics(this.buffer.width,this.buffer.height),this.bufferShape.push(),this.bufferShape.drawingContext.filter=`blur(${this.blurSize}px)`,this.strokeColor=this.shape.colorB,this.bufferShape.stroke(this.strokeColor),this.bufferShape.strokeWeight(this.strokeWeight),this.bufferShape.fill(color(red(this.shape.color),green(this.shape.color),blue(this.shape.color),150)),this.bufferShape.beginShape(),this.bufferShape.vertex(this.shape.A.x,this.shape.A.y),this.bufferShape.vertex(this.shape.B.x,this.shape.B.y),this.bufferShape.vertex(this.shape.C.x,this.shape.C.y),this.bufferShape.endShape(CLOSE),this.bufferShape.pop(),this.buffer.image(this.bufferShape,0,0)}drawNakedShape(){this.strokeWeight=7,this.blurSize=2,this.bufferShape=createGraphics(this.buffer.width,this.buffer.height),this.bufferShape.push(),this.bufferShape.drawingContext.filter=`blur(${this.blurSize}px)`,this.strokeColor=this.shape.color,this.bufferShape.stroke(this.strokeColor),this.bufferShape.strokeWeight(this.strokeWeight),this.bufferShape.noFill(),this.bufferShape.beginShape(),this.bufferShape.vertex(this.shape.A.x,this.shape.A.y),this.bufferShape.vertex(this.shape.B.x,this.shape.B.y),this.bufferShape.vertex(this.shape.C.x,this.shape.C.y),this.bufferShape.endShape(CLOSE),this.bufferShape.pop(),this.buffer.image(this.bufferShape,0,0)}showPoints(e,h,s){this.buffer.push(),this.buffer.stroke(s),this.buffer.strokeWeight(8),this.buffer.point(e,h),this.buffer.pop()}createBrushTiles(e,h,s){var t,i;if(t=s.toString("#rrggbb"),void 0===this.sprites[t]){for(var r=[],p=0;p<this.spriteCount;p++)r.push(this.createPupselSprite(t));this.sprites[t]=r}push(),i=getRandomFromList(this.sprites[t]),this.buffer.imageMode(CENTER),this.buffer.image(i,e,h),pop()}createPupselSprite(e){let h=createGraphics(2*this.brushSize,2*this.brushSize);for(var s=0;s<this.brushNumber;s++)h.push(),h.stroke(distortColorSuperNew(e,30)),h.strokeWeight(this.brushStrokeWeight),h.line(h.width/2,h.height/2,h.width/2+getRandomFromInterval(-this.brushSize,this.brushSize),h.height/2+getRandomFromInterval(-this.brushSize,this.brushSize)),h.pop();return h}}